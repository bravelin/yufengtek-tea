(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1d092fd5"],{1294:function(t,e,a){"use strict";var i=a("b2f5"),n=a("2d43")(2);i(i.P+i.F*!a("119c")([].filter,!0),"Array",{filter:function(t){return n(this,t,arguments[1])}})},"197a":function(t,e,a){},"65dd":function(t,e,a){"use strict";var i=a("197a"),n=a.n(i);n.a},"77be":function(t,e,a){},"8c53":function(t,e,a){"use strict";var i=a("b2f5"),n=a("3a68"),o=a("c481"),r=a("b146"),s=[].lastIndexOf,c=!!s&&1/[1].lastIndexOf(1,-0)<0;i(i.P+i.F*(c||!a("119c")(s)),"Array",{lastIndexOf:function(t){if(c)return s.apply(this,arguments)||0;var e=n(this),a=r(e.length),i=a-1;for(arguments.length>1&&(i=Math.min(i,o(arguments[1]))),i<0&&(i=a+i);i>=0;i--)if(i in e&&e[i]===t)return i||0;return-1}})},cb13:function(t,e,a){"use strict";var i=a("77be"),n=a.n(i);n.a},ecf9:function(t,e,a){"use strict";a.r(e);var i,n,o,r,s,c,l,u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page iot-page"},[a("div",{staticClass:"left-container"},[a("Amount"),a("FM1Charts",{directives:[{name:"show",rawName:"v-show",value:t.currActive.type==t.types.IOT_TYPE_FM1,expression:"currActive.type == types.IOT_TYPE_FM1"}]}),a("FM2Charts",{directives:[{name:"show",rawName:"v-show",value:t.currActive.type==t.types.IOT_TYPE_FM2,expression:"currActive.type == types.IOT_TYPE_FM2"}]}),a("WFCharts",{directives:[{name:"show",rawName:"v-show",value:t.currActive.type==t.types.IOT_TYPE_WF,expression:"currActive.type == types.IOT_TYPE_WF"}]}),a("CameraVideo",{directives:[{name:"show",rawName:"v-show",value:t.currActive.type==t.types.IOT_TYPE_GUN,expression:"currActive.type == types.IOT_TYPE_GUN"}]})],1),a("GMap"),a("PhotoViewer",{directives:[{name:"show",rawName:"v-show",value:t.photoViewerFullState,expression:"photoViewerFullState"}]}),t.useFlash?t._e():a("Camera360",{directives:[{name:"show",rawName:"v-show",value:t.camera360FullState,expression:"camera360FullState"}]}),t.useFlash?a("Camera360Flash",{directives:[{name:"show",rawName:"v-show",value:t.camera360FullState,expression:"camera360FullState"}]}):t._e(),a("Message")],1)},d=[],m=(a("7a59"),a("e20c")),h=a("eb57"),f=a("591a"),p=a("0706"),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Plane",{staticClass:"iot-wrap"},[a("PlaneTitle",[t._v("设备数量")]),a("div",{staticClass:"plane-content"},[a("div",{staticClass:"iot-item",class:{active:"monitor"==t.currVisibleIotType},on:{click:function(e){return t.changeIotDatas("monitor")}}},[a("div",[t._v("监测站设备")]),a("div",[t._v(t._s(t.monitorAmount))])]),a("div",{staticClass:"iot-item",class:{active:"camera"==t.currVisibleIotType},on:{click:function(e){return t.changeIotDatas("camera")}}},[a("div",[t._v("摄像头设备")]),a("div",[t._v(t._s(t.cameraAmount))])])])],1)},y=[],g=p["a"].IOT,w=Object(f["a"])(g).mapState,_={name:"IotAmount",computed:Object(m["a"])({},w(["currVisibleIotType","cameraAmount","monitorAmount","fertilizerAmount","waterFertilizerAmount"])),methods:{changeIotDatas:function(t){var e=this,a=e.$store;e.currVisibleIotType!=t?a.dispatch(g+"/"+h["a"].CHANGE_ACTIVE_IOT_TYPE,t):a.commit(g+"/"+h["a"].CHANGE_VISIBLE_IOT_TYPE,"")}}},T=_,C=a("17cc"),b=Object(C["a"])(T,v,y,!1,null,null,null),S=b.exports,x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Plane",{staticClass:"iot-container",attrs:{full:t.fm1.curveChartFullState}},[a("PlaneTitle",[t._v(t._s(t.fm1.iotName||"FM1")+"实时环境")]),a("ul",{staticClass:"data-list"},[a("li",{staticClass:"temperature",class:{active:"temperature"==t.fm1.type},on:{click:function(e){return t.switchFm("temperature","温度")}}},[a("div",[t._v(t._s(t.fm1.data.temperature)+"°C")]),a("div",[t._v("温度")])]),a("li",{staticClass:"humidity",class:{active:"humidity"==t.fm1.type},on:{click:function(e){return t.switchFm("humidity","湿度")}}},[a("div",[t._v(t._s(t.fm1.data.humidity)+"%")]),a("div",[t._v("湿度")])]),a("li",{staticClass:"light",class:{active:"light"==t.fm1.type},on:{click:function(e){return t.switchFm("light","光照")}}},[a("div",[t._v(t._s(t.fm1.data.light)+"Lux")]),a("div",[t._v("光照")])]),a("li",{staticClass:"pressure",class:{active:"pressure"==t.fm1.type},on:{click:function(e){return t.switchFm("pressure","气压")}}},[a("div",[t._v(t._s(t.fm1.data.pressure)+"Pa")]),a("div",[t._v("气压")])])]),a("ul",{staticClass:"selector"},[a("li",{class:{active:"HOUR"==t.fm1.time},on:{click:function(e){return t.switchFmTimeType("HOUR")}}},[t._v("时刻数据")]),a("li",{class:{active:"WEEK"==t.fm1.time},on:{click:function(e){return t.switchFmTimeType("WEEK")}}},[t._v("七天数据")])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.fm1.chartDatas.length,expression:"fm1.chartDatas.length"}],staticClass:"chart-unit"},[t._v("单位："+t._s(t.fm1.chartUnit))]),a("div",{ref:"chart",staticClass:"plane-content",class:{hide:!t.fm1.chartDatas.length}}),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.fm1.chartDatas.length,expression:"!fm1.chartDatas.length"}],staticClass:"iconfont null-data-tag"},[t._v("")]),a("PlaneTools",{directives:[{name:"show",rawName:"v-show",value:t.fm1.chartDatas.length,expression:"fm1.chartDatas.length"}],attrs:{full:t.fm1.curveChartFullState},on:{change:t.doFullStateChange}})],1)},O=[],k=(a("f763"),a("7364"),a("11ac"),a("cb1d")),A=a("3604"),E=a("f1ed"),I=p["a"].IOT,P="curveChartFullState",F="chartDatas",L="data",M=Object(f["a"])(I).mapState,N="$store.state.".concat(I,".fm1"),D=("".concat(N,".").concat(L),"".concat(N,".").concat(F)),$="".concat(N,".").concat(P),j="$store.state.windowResizeState",R={name:"IotFm1Charts",computed:Object(m["a"])({},M(["fm1"]),Object(f["c"])(["smallScreen","miniScreen"])),watch:(i={},Object(k["a"])(i,D,function(){this.doInitOrRefreshChart()}),Object(k["a"])(i,$,function(){this.doInitOrRefreshChart()}),Object(k["a"])(i,j,function(){this.doInitOrRefreshChart()}),i),data:function(){return{container:null,chart:null}},mounted:function(){var t=this;t.$nextTick(function(){t.container=t.$refs.chart,t.fm1[F].length&&t.doInitOrRefreshChart()})},methods:{doInitOrRefreshChart:function(){var t=this,e=t.fm1[F];if(e&&e.length){var a=t.container;if(a){var i=t.doHandlerData(t.fm1.chartDatas),n=i.titles,o=i.lineDatas,r=t.getBaseOptions(n,o);t.fixOptions(r,n,o),t.chart?(t.chart.setOption(r),setTimeout(function(){t.chart.resize()},200)):(t.chart=A["a"].init(a),t.chart.setOption(r))}}},getBaseOptions:function(t,e){var a=this,i=Object(E["a"])(a.fm1.chartDatas.map(function(t){return t.data}),4),n=i.min,o=i.max,r=i.interval;return{grid:{top:20,left:22,right:20,bottom:12,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:"rgba(0, 159, 253, 0.5)",axisPointer:{lineStyle:{color:"rgba(238,238,238,0.4)"}},formatter:function(t){return"时间：".concat(t[0].name,"<br/>").concat(a.fm1.name,"：").concat(t[0].data.value," ").concat(a.fm1.chartUnit)},textStyle:{fontSize:14}},xAxis:{type:"category",data:t,boundaryGap:!0,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{margin:15,textStyle:{color:"#fff",fontSize:12}},splitLine:{show:!1,lineStyle:{type:"dosh",color:"rgba(38, 99, 188, 0.15)"}}},yAxis:{show:!0,min:n,max:o,interval:r,splitLine:{show:!0,lineStyle:{type:"dosh",color:"rgba(255, 255, 255, 0.2)"}},axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!0,color:"#fff",textStyle:{fontSize:12}}},series:[{type:"line",data:e,symbol:"circle",symbolSize:6,showSymbol:!0,smooth:!0,itemStyle:{normal:{color:"#9be1fc",label:{show:!1}}},lineStyle:{width:2,color:"rgb(153, 227, 253)"},areaStyle:{normal:{color:new A["a"].graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(153, 228, 253, 0.6)"},{offset:1,color:"rgba(45, 80, 131, 0.1)"}],!1)}}}]}},fixOptions:function(t,e,a){var i=this;if(i.fm1[P]){if(!i.smallScreen&&!i.miniScreen){var n=Object(E["a"])(i.fm1.chartDatas.map(function(t){return t.data}),6),o=n.min,r=n.max,s=n.interval;t.yAxis.min=o,t.yAxis.max=r,t.yAxis.interval=s,t.yAxis.axisLabel.margin=12,t.yAxis.axisLabel.textStyle.fontSize=15,t.xAxis.axisLabel.margin=12,t.xAxis.axisLabel.textStyle.fontSize=15,t.tooltip.textStyle.fontSize=18}}else i.miniScreen?(t.grid={top:20,left:12,right:12,bottom:6,containLabel:!0},t.series[0].symbolSize=5,t.series[0].lineStyle.width=1,t.xAxis.axisLabel.margin=7,t.xAxis.axisLabel.textStyle.fontSize=9,t.yAxis.axisLabel.margin=7,t.yAxis.axisLabel.textStyle.fontSize=9,t.tooltip.textStyle.fontSize=10):i.smallScreen&&(t.grid={top:20,left:15,right:15,bottom:8,containLabel:!0},t.series[0].symbolSize=7,t.series[0].itemStyle.normal.label.fontSize=10,t.series[0].lineStyle.width=1,t.xAxis.axisLabel.margin=9,t.xAxis.axisLabel.textStyle.fontSize=11,t.yAxis.axisLabel.margin=9,t.yAxis.axisLabel.textStyle.fontSize=11,t.tooltip.textStyle.fontSize=12)},switchFm:function(t,e){var a=this,i=a.$store;if(a.fm1.type!=t){i.commit(I+"/"+h["a"].SWITCH_FM1_TYPE,{value:t,name:e});var n=i.state[I]["fm1"].sno;i.dispatch(I+"/"+h["a"].GET_FM1_DATA,n)}},switchFmTimeType:function(t){var e=this,a=e.$store;if(e.fm1.time!=t){var i=e.fm1.sno;a.commit(I+"/"+h["a"].SWITCH_FM1_TIME_TYPE,t),a.dispatch(I+"/"+h["a"].GET_FM1_DATA,i)}},doHandlerData:function(t){var e=[],a=[];return t.forEach(function(t){e.push(t.title.length>6?t.title.substr(5):t.title),a.push({name:t.title,value:t.data})}),{titles:e,lineDatas:a}},doFullStateChange:function(t){var e=this;e.$store.commit(I+"/"+h["a"].IOT_CHANGE_FULL_STATE,{fullStateName:P,subModuleName:"fm1",state:t})}}},H=R,U=Object(C["a"])(H,x,O,!1,null,null,null),G=U.exports,V=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Plane",{staticClass:"iot-container",attrs:{full:t.fm2.curveChartFullState}},[a("PlaneTitle",[t._v(t._s(t.fm2.iotName||"FM2")+"实时环境")]),a("ul",{staticClass:"data-list"},[a("li",{staticClass:"wind",class:{active:"wind"==t.fm2.type},on:{click:function(e){return t.switchFm("wind","风速")}}},[a("div",[t._v(t._s(t.fm2.data.wind)+"m/s")]),a("div",[t._v("风速")])]),a("li",{staticClass:"rain",class:{active:"rain"==t.fm2.type},on:{click:function(e){return t.switchFm("rain","降雨量")}}},[a("div",[t._v(t._s(t.fm2.data.rain)+"mm")]),a("div",[t._v("降雨量")])]),a("li",{staticClass:"soil-temperature",class:{active:"temperature"==t.fm2.type},on:{click:function(e){return t.switchFm("temperature","土壤温度")}}},[a("div",[t._v(t._s(t.fm2.data.temperature)+"°C")]),a("div",[t._v("土壤温度")])]),a("li",{staticClass:"soil-humidity",class:{active:"humidity"==t.fm2.type},on:{click:function(e){return t.switchFm("humidity","土壤湿度")}}},[a("div",[t._v(t._s(t.fm2.data.humidity)+"%")]),a("div",[t._v("土壤湿度")])])]),a("ul",{staticClass:"selector"},[a("li",{class:{active:"HOUR"==t.fm2.time},on:{click:function(e){return t.switchFmTimeType("HOUR")}}},[t._v("时刻数据")]),a("li",{class:{active:"WEEK"==t.fm2.time},on:{click:function(e){return t.switchFmTimeType("WEEK")}}},[t._v("七天数据")])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.fm2.chartDatas.length,expression:"fm2.chartDatas.length"}],staticClass:"chart-unit"},[t._v("单位："+t._s(t.fm2.chartUnit))]),a("div",{ref:"chart",staticClass:"plane-content",class:{hide:!t.fm2.chartDatas.length}}),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.fm2.chartDatas.length,expression:"!fm2.chartDatas.length"}],staticClass:"iconfont null-data-tag"},[t._v("")]),a("PlaneTools",{directives:[{name:"show",rawName:"v-show",value:t.fm2.chartDatas.length,expression:"fm2.chartDatas.length"}],attrs:{full:t.fm2.curveChartFullState},on:{change:t.doFullStateChange}})],1)},z=[],W=p["a"].IOT,Y="curveChartFullState",K="chartDatas",q=Object(f["a"])(W).mapState,B="$store.state.".concat(W,".fm2.").concat(K),Z="$store.state.".concat(W,".fm2.").concat(Y),J="$store.state.windowResizeState",Q={name:"IotFm2Charts",computed:Object(m["a"])({},q(["fm2"]),Object(f["c"])(["smallScreen","miniScreen"])),watch:(n={},Object(k["a"])(n,B,function(){this.doInitOrRefreshChart()}),Object(k["a"])(n,Z,function(){this.doInitOrRefreshChart()}),Object(k["a"])(n,J,function(){this.doInitOrRefreshChart()}),n),data:function(){return{container:null,chart:null}},mounted:function(){var t=this;t.$nextTick(function(){t.container=t.$refs.chart,t.fm2[K].length&&t.doInitOrRefreshChart()})},methods:{doInitOrRefreshChart:function(){var t=this,e=t.fm2[K];if(e&&e.length){var a=t.container;if(t.container){var i=t.doHandlerData(t.fm2.chartDatas),n=i.titles,o=i.lineDatas,r=t.getBaseOptions(n,o);t.fixOptions(r,n,o),t.chart?(t.chart.setOption(r),setTimeout(function(){t.chart.resize()},200)):(t.chart=A["a"].init(a),t.chart.setOption(r))}}},getBaseOptions:function(t,e){var a=this,i=Object(E["a"])(a.fm2.chartDatas.map(function(t){return t.data}),4),n=i.min,o=i.max,r=i.interval;return{grid:{top:20,left:22,right:20,bottom:12,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:"rgba(0, 159, 253, 0.5)",axisPointer:{lineStyle:{color:"rgba(238,238,238,0.4)"}},formatter:function(t){return"时间：".concat(t[0].name,"<br/>").concat(a.fm2.name,"：").concat(t[0].data.value," ").concat(a.fm2.chartUnit)},textStyle:{fontSize:14}},xAxis:{type:"category",data:t,boundaryGap:!0,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{margin:15,textStyle:{color:"#fff",fontSize:12}},splitLine:{show:!1,lineStyle:{type:"dosh",color:"rgba(38, 99, 188, 0.15)"}}},yAxis:{show:!0,min:n,max:o,interval:r,splitLine:{show:!0,lineStyle:{type:"dosh",color:"rgba(255, 255, 255, 0.2)"}},axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!0,color:"#fff",textStyle:{fontSize:12}}},series:[{type:"line",data:e,lineStyle:{width:2,color:"rgb(153, 227, 253)"},showSymbol:!0,smooth:!0,symbol:"wind"==a.fm2.type?"image://".concat(location.origin,"/images/arrow.png"):"circle",symbolSize:"wind"==a.fm2.type?20:6,itemStyle:{normal:{color:"#9be1fc",label:{show:!1}}},areaStyle:{normal:{color:new A["a"].graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(153, 228, 253, 0.6)"},{offset:1,color:"rgba(45, 80, 131, 0.1)"}],!1)}}}]}},fixOptions:function(t,e,a){var i=this;if(i.fm2[Y]){if(!i.smallScreen&&!i.miniScreen){var n=Object(E["a"])(i.fm2.chartDatas.map(function(t){return t.data}),6),o=n.min,r=n.max,s=n.interval;t.yAxis.min=o,t.yAxis.max=r,t.yAxis.interval=s,t.yAxis.axisLabel.margin=12,t.yAxis.axisLabel.textStyle.fontSize=15,t.xAxis.axisLabel.margin=12,t.xAxis.axisLabel.textStyle.fontSize=15,t.tooltip.textStyle.fontSize=18}}else i.miniScreen?(t.grid={top:20,left:12,right:12,bottom:6,containLabel:!0},t.series[0].symbolSize="wind"==i.fm2.type?15:5,t.series[0].lineStyle.width=1,t.xAxis.axisLabel.margin=7,t.xAxis.axisLabel.textStyle.fontSize=9,t.yAxis.axisLabel.margin=7,t.yAxis.axisLabel.textStyle.fontSize=9,t.tooltip.textStyle.fontSize=10):i.smallScreen&&(t.grid={top:20,left:15,right:15,bottom:8,containLabel:!0},t.series[0].symbolSize="wind"==i.fm2.type?18:7,t.series[0].itemStyle.normal.label.fontSize=10,t.series[0].lineStyle.width=1,t.xAxis.axisLabel.margin=9,t.xAxis.axisLabel.textStyle.fontSize=11,t.yAxis.axisLabel.margin=9,t.yAxis.axisLabel.textStyle.fontSize=11,t.tooltip.textStyle.fontSize=12)},switchFm:function(t,e){var a=this,i=a.$store;if(a.currFm!=t){var n=a.fm2.sno;i.commit(W+"/"+h["a"].SWITCH_FM2_TYPE,{value:t,name:e}),i.dispatch(W+"/"+h["a"].GET_FM2_DATA,n)}},switchFmTimeType:function(t){var e=this,a=e.$store;if(e.fm2.time!=t){var i=e.fm2.sno;a.commit(W+"/"+h["a"].SWITCH_FM2_TIME_TYPE,t),a.dispatch(W+"/"+h["a"].GET_FM2_DATA,i)}},doHandlerData:function(t){var e=this,a=[],i=[],n=null;return t.forEach(function(t){a.push(t.title.length>6?t.title.substr(5):t.title),n={name:t.title,value:t.data},"wind"==e.fm2.type&&(n.symbolRotate=t.rotate),i.push(n)}),{titles:a,lineDatas:i}},doFullStateChange:function(t){var e=this;e.$store.commit(W+"/"+h["a"].IOT_CHANGE_FULL_STATE,{fullStateName:Y,subModuleName:"fm2",state:t})}}},X=Q,tt=Object(C["a"])(X,V,z,!1,null,null,null),et=tt.exports,at=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Plane",{staticClass:"iot-container",attrs:{full:t.wf.curveChartFullState}},[a("PlaneTitle",[t._v("水肥环境")]),a("ul",{staticClass:"data-list"},[a("li",{staticClass:"ec",class:{active:"ec"==t.wf.type},on:{click:function(e){return t.switchFm("ec","EC")}}},[a("div",[t._v(t._s(t.wf.data.ec)+"mS/cm")]),a("div",[t._v("EC")])]),a("li",{staticClass:"ph",class:{active:"ph"==t.wf.type},on:{click:function(e){return t.switchFm("ph","PH")}}},[a("div",[t._v(t._s(t.wf.data.ph))]),a("div",[t._v("PH")])]),a("li",{staticClass:"water",class:{active:"water"==t.wf.type},on:{click:function(e){return t.switchFm("water","水流量")}}},[a("div",[t._v(t._s(t.wf.data.water)+"L")]),a("div",[t._v("水流量(月)")])]),a("li",{staticClass:"fertilizer",class:{active:"fertilizer"==t.wf.type},on:{click:function(e){return t.switchFm("fertilizer","肥流量")}}},[a("div",[t._v(t._s(t.wf.data.fertilizer)+"kg")]),a("div",[t._v("肥流量(月)")])])]),a("ul",{directives:[{name:"show",rawName:"v-show",value:"ec"==t.wf.type||"ph"==t.wf.type,expression:"wf.type=='ec' || wf.type=='ph'"}],staticClass:"selector"},[a("li",{class:{active:"HOUR"==t.wf.time},on:{click:function(e){return t.switchFmTimeType("HOUR")}}},[t._v("时刻数据")]),a("li",{class:{active:"WEEK"==t.wf.time},on:{click:function(e){return t.switchFmTimeType("WEEK")}}},[t._v("七天数据")])]),a("div",{ref:"chart",staticClass:"plane-content"}),a("PlaneTools",{attrs:{full:t.wf.curveChartFullState},on:{change:t.doFullStateChange}})],1)},it=[],nt=p["a"].IOT,ot="curveChartFullState",rt="chartDatas",st=Object(f["a"])(nt).mapState,ct="$store.state.".concat(nt,".wf.").concat(rt),lt="$store.state.".concat(nt,".wf.").concat(ot),ut="$store.state.windowResizeState",dt={name:"IotWfCharts",computed:Object(m["a"])({},st(["wf"])),watch:(o={},Object(k["a"])(o,ct,function(){this.doInitOrRefreshChart()}),Object(k["a"])(o,lt,function(){this.doInitOrRefreshChart()}),Object(k["a"])(o,ut,function(){this.doInitOrRefreshChart()}),o),data:function(){return{container:null,chart:null}},mounted:function(){var t=this;t.$nextTick(function(){t.container=t.$refs.chart,t["wf"][rt].length&&t.initChart()})},methods:{doInitOrRefreshChart:function(){var t=this,e=t.$store.state[nt]["wf"][rt];e&&e.length&&t.container&&(t.chart?t.refreshChart(e):t.initChart(e))},switchFm:function(t,e){var a=this,i=a.$store;a.currFm!=t&&(i.commit(nt+"/"+h["a"].SWITCH_WF_TYPE,{value:t,name:e}),setTimeout(function(){i.dispatch(nt+"/"+h["a"].GET_WF_CHART_DATA)},1e3))},switchFmTimeType:function(t){var e=this,a=e.$store;e.wf.time!=t&&(a.commit(nt+"/"+h["a"].SWITCH_WF_TIME_TYPE,t),a.dispatch(nt+"/"+h["a"].GET_WF_CHART_DATA))},initChart:function(){var t=this,e=t.doHandlerData(t.wf.chartDatas),a=e.titles,i=(e.barDatas,e.lineDatas);t.chart=A["a"].init(t.container);var n={grid:{top:20,left:10,right:10,bottom:12,containLabel:!0},tooltip:{trigger:"axis",backgroundColor:"rgba(0, 159, 253, 0.5)",axisPointer:{lineStyle:{color:"rgba(238,238,238,0.4)"}},formatter:function(e){return"时间：".concat(e[0].name,"<br/>").concat(t.wf.name,"：").concat(e[0].data.value," ").concat(t.wf.chartUnit)}},xAxis:[{type:"category",data:a,boundaryGap:!0,axisTick:{show:!1},axisLine:{lineStyle:{color:"rgba(38, 99, 188, 0.5)"}},axisLabel:{margin:15,textStyle:{color:"#fff"}},splitLine:{show:!1,lineStyle:{type:"dosh",color:"rgba(38, 99, 188, 0.15)"}}}],yAxis:[{show:!0,splitLine:{show:!0,lineStyle:{type:"dosh",color:"rgba(38, 99, 188, 0.3)"}},axisTick:{show:!1},axisLine:{show:!0,lineStyle:{color:"rgba(38, 99, 188, 0.5)"}},axisLabel:{show:!0,color:"#fff"}}],color:["rgb(67, 81, 124)"],series:[{type:"line",data:i,symbol:"circle",symbolSize:6,showSymbol:!0,smooth:!0,areaStyle:{normal:{color:new A["a"].graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(67, 81, 124, 0.3)"},{offset:1,color:"rgba(67, 81, 124, 0.1)"}],!1)}}}]};t.chart.setOption(n)},refreshChart:function(){var t=this,e=t.chart,a=t.doHandlerData(t.wf.chartDatas),i=a.titles,n=(a.barDatas,a.lineDatas),o=e.getOption(),r=o.series,s=o.xAxis,c=o.tooltip;r[0].data=n,s[0].data=i,c.formatter=function(e){return"时间：".concat(e[0].name,"点<br/>").concat(t.wf.name,"：").concat(e[0].data.value," ").concat(t.wf.chartUnit)},e.setOption({series:r,xAxis:s,tooltip:c}),setTimeout(function(){e.resize()},200)},doHandlerData:function(t){var e=[],a=[],i=[];return t.forEach(function(t){e.push(t.title),a.push({name:t.title,value:t.data}),i.push({name:t.title,value:t.data})}),{titles:e,lineDatas:i,barDatas:a}},doFullStateChange:function(t){var e=this;e.$store.commit(nt+"/"+h["a"].IOT_CHANGE_FULL_STATE,{fullStateName:ot,state:t})}}},mt=dt,ht=Object(C["a"])(mt,at,it,!1,null,null,null),ft=ht.exports,pt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Plane",{staticClass:"iot-container camera-video"},[a("PlaneTitle",[t._v("视频监控"),a("span",{directives:[{name:"show",rawName:"v-show",value:t.videoName,expression:"videoName"}]},[t._v("（"+t._s(t.videoName)+"）")])]),a("div",{staticClass:"plane-content"},[a("div",{ref:"container",staticClass:"video-container",style:{height:t.containerHeight+"px"}},[a("video",{ref:"videoPlayer",staticClass:"video-js vjs-default-skin video-wrap",attrs:{controls:""}})])])],1)},vt=[],yt=(a("a7be"),a("34a3"),p["a"].IOT),gt=Object(f["a"])(yt).mapState,wt="$store.state.".concat(yt),_t="".concat(wt,".videoUrl"),Tt="".concat(wt,".currActive.type"),Ct="".concat(wt,".photoViewerFullState"),bt="".concat(wt,".camera360FullState"),St={name:"IotCameraVideo",computed:Object(m["a"])({},gt(["videoUrl","videoName"])),watch:(r={},Object(k["a"])(r,_t,function(t){this.init()}),Object(k["a"])(r,Tt,function(t){var e=this;t==h["a"].IOT_TYPE_GUN?this.init():e.player&&e.player.pause()}),Object(k["a"])(r,Ct,function(t){this.doPauseOrResume(t)}),Object(k["a"])(r,bt,function(t){this.doPauseOrResume(t)}),r),mounted:function(){var t=this;t.$nextTick(function(){t.init()})},data:function(){return{player:null,containerHeight:0,inProcessing:!1}},methods:{init:function(){var t=this;t.$nextTick(function(){var e=t.getSize(),a=e.w,i=e.h;i>=200&&t.initVideo(a,i)})},initVideo:function(t,e){var a=this,i=a.videoUrl;if(i&&!a.inProcessing){a.inProcessing=!0,setTimeout(function(){a.inProcessing=!1},300);var n=a.$refs.videoPlayer,o=E["d"].ios.test(navigator.userAgent)?i.replace(/https:/,"http:"):i.replace(/http:/,"https:");window.hd?o.indexOf(".hd.")<0&&(o=o.replace(".m3u8",".hd.m3u8")):o.indexOf(".hd.")>0&&(o=o.replace(".hd.m3u8",".m3u8"));var r={autoplay:!0,preload:"auto",language:"zh-CN",sources:[{type:"application/x-mpegURL",src:o}],notSupportedMessage:"暂时无法播放",html5:{hls:{withCredentials:!1}},controlBar:{playToggle:!1,fullscreenToggle:!0,remainingTimeDisplay:!1,timeDivider:!1,durationDisplay:!1}};a.containerHeight=e;var s=t,c=e;n.style.width=s+"px",n.style.height=c+"px",n.style.objectFit="fill",a.$nextTick(function(){a.player?(a.player.src(o),a.player.load()):a.player=videojs(n,r)})}},doPauseOrResume:function(t){var e=this;e.player&&(t?e.player.pause():e.player.play())},getSize:function(){var t=this,e=t.$refs.container;if(e){var a=getComputedStyle(e,null),i=parseInt(a.width)||0,n=.75*i;return{w:i,h:n}}return{w:0,h:0}}},beforeDestroy:function(){var t=this;t.player&&t.player.dispose()}},xt=St,Ot=Object(C["a"])(xt,pt,vt,!1,null,null,null),kt=Ot.exports,At=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Plane",{staticClass:"camera360 no-shadow",attrs:{full:t.camera360FullState}},[a("PlaneTitle",{on:{click:function(e){return t.doHideControlButton()}}},[t._v("视频监控"),a("span",{directives:[{name:"show",rawName:"v-show",value:t.video360Name,expression:"video360Name"}]},[t._v("（"+t._s(t.video360Name)+"）")])]),a("div",{staticClass:"plane-content"},[a("div",{ref:"container",staticClass:"video-container flv"},[a("video",{staticClass:"video-js vjs-default-skin video-wrap",attrs:{controls:""}})]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showProxyVideo,expression:"showProxyVideo"}],ref:"proxyContainer",staticClass:"video-container hls"},[a("video",{staticClass:"video-js vjs-default-skin video-wrap",attrs:{controls:""}})])]),a("PlaneTools",{attrs:{full:t.camera360FullState},on:{change:t.doFullStateChange}}),a("ControlPanel",{on:{change:t.doControlPanelChange}})],1)},Et=[],It=(a("8c53"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"control-panel",class:{active:t.controlButtonIsActive},on:{click:function(e){return t.doChangeStatus()}}},[a("div",{staticClass:"inner-control-panel"},[a("div",{on:{click:function(e){return t.doClick("ZoomIn",e)}}},[t._v("+")]),a("div",{staticClass:"iconfont",on:{click:function(e){return t.doClick("Stop",e)}}},[t._v("")]),a("div",{on:{click:function(e){return t.doClick("ZoomOut",e)}}},[t._v("-")])]),a("div",{staticClass:"control-panel-top control-button",on:{click:function(e){return t.doClick("ArrowUp",e)}}},[a("i",{staticClass:" iconfont"},[t._v("")])]),a("div",{staticClass:"control-panel-bottom control-button",on:{click:function(e){return t.doClick("ArrowDown",e)}}},[a("i",{staticClass:" iconfont"},[t._v("")])]),a("div",{staticClass:"control-panel-left control-button",on:{click:function(e){return t.doClick("ArrowLeft",e)}}},[a("i",{staticClass:" iconfont"},[t._v("")])]),a("div",{staticClass:"control-panel-right control-button",on:{click:function(e){return t.doClick("ArrowRight",e)}}},[a("i",{staticClass:" iconfont"},[t._v("")])])])}),Pt=[],Ft=p["a"].IOT,Lt=Object(f["a"])(Ft).mapState,Mt={name:"ControlPanel",computed:Object(m["a"])({},Lt(["controlButtonIsActive"])),methods:{doClick:function(t,e){e&&e.stopPropagation(),this.$emit("change",t)},doChangeStatus:function(){this.$store.commit(Ft+"/"+h["a"].CHANGE_CONTROL_BUTTON_STATUS,!0)}}},Nt=Mt,Dt=Object(C["a"])(Nt,It,Pt,!1,null,null,null),$t=Dt.exports,jt="camera360FullState",Rt=p["a"].IOT,Ht=Object(f["a"])(Rt).mapState,Ut="$store.state.".concat(Rt),Gt=("".concat(Ut,".videoUrl360"),"".concat(Ut,".camera360FullState")),Vt="$store.state.windowResizeState",zt={ArrowUp:0,ArrowDown:1,ArrowLeft:2,ArrowRight:3,ZoomIn:8,ZoomOut:9,Stop:"stop"},Wt={name:"Iot360Video",components:{ControlPanel:$t},computed:Object(m["a"])({},Ht(["videoUrl360","video360Name","camera","camera360FullState"])),created:function(){var t=this;t.$store;document.addEventListener("keydown",t.doHandleKeyDown),document.addEventListener("keyup",t.doHandleKeyUp)},watch:(s={},Object(k["a"])(s,Gt,function(t){var e=this;if(t)e.init();else{e.player&&e.player.dispose(),e.player=null,e.proxyPlayer=null,e.showProxyVideo=!0;var a=e.$refs;a.container.innerHTML='<video class="video-js vjs-default-skin video-wrap" controls></video>',a.proxyContainer.innerHTML='<video class="video-js vjs-default-skin video-wrap" controls></video>',setTimeout(function(){e.videoWrap=a.container.querySelector("video"),e.proxyVideoWrap=a.proxyContainer.querySelector("video")},50),e.$store.commit(Rt+"/"+h["a"].CHANGE_CONTROL_BUTTON_STATUS,!1)}}),Object(k["a"])(s,Vt,function(){var t=this,e=t.getSize(),a=e.w,i=e.h,n=a,o=i,r=t.videoWrap,s=t.proxyVideoWrap;t.player&&t.videoWrap&&(r.style.width=n+"px",r.style.height=o+"px"),t.proxyPlayer&&t.proxyVideoWrap&&(s.style.width=n+"px",s.style.height=o+"px")}),s),mounted:function(){var t=this;t.$nextTick(function(){var e=t.$refs;t.videoWrap=e.container.querySelector("video"),t.proxyVideoWrap=e.proxyContainer.querySelector("video"),t.init()})},data:function(){return{videoWrap:null,proxyVideoWrap:null,player:null,proxyPlayer:null,showProxyVideo:!0,currPressedKey:"",currPressedKeyCode:"",directionChangeReqList:[],reqListProcessing:!1}},methods:{init:function(){var t=this;t.$nextTick(function(){var e=t.getSize(),a=e.w,i=e.h;a>500&&t.initVideo(a,i)})},initVideo:function(t,e){var a=this,i=a.videoUrl360;if(i){var n=a.videoWrap,o=a.proxyVideoWrap,r=a.getVideoUrl(i),s=r.hls,c=(r.flv,{autoplay:!0,preload:"auto",language:"zh-CN",sources:[{type:"application/x-mpegURL",src:s}],notSupportedMessage:"暂时无法播放",html5:{hls:{withCredentials:!1}},controlBar:{playToggle:!1,fullscreenToggle:!0,remainingTimeDisplay:!1,timeDivider:!1,durationDisplay:!1}}),l=t,u=e;n.style.width=l+"px",n.style.height=u+"px",o.style.width=l+"px",o.style.height=u+"px";a.player,a.proxyPlayer;a.$nextTick(function(){a.proxyPlayer?(a.proxyPlayer.src(s),a.proxyPlayer.load()):a.proxyPlayer=videojs(o,c)})}},getSize:function(){var t=this,e=t.$refs.container.parentNode;if(e){var a=getComputedStyle(e,null),i=parseInt(a.width)||0,n=parseInt(a.height)||0;return{w:i,h:n}}return{w:0,h:0}},doFullStateChange:function(t){var e=this;e.$store.commit(Rt+"/"+h["a"].IOT_CHANGE_FULL_STATE,{fullStateName:jt,state:t})},getVideoUrl:function(t){var e=t.lastIndexOf("/"),a=t.substr(e+1,32),i=E["d"].ios.test(navigator.userAgent)?"http":"https",n="".concat(i,"://hls01open.ys7.com/openlive/").concat(a).concat(window.hd?".hd":"",".m3u8"),o="https://flvopen.ys7.com:9188/openlive/".concat(a).concat(window.hd?".hd":"",".flv");return{hls:n,flv:o}},doHandleKeyDown:function(t){var e=this,a=e.getKeyCode(t);"number"==typeof a&&e.camera360FullState&&(e.currPressedKey=t.key,e.currPressedKeyCode=a,e.rquestChange(a))},doHandleKeyUp:function(t){var e=this;t.key;"number"==typeof e.currPressedKeyCode&&e.camera360FullState&&(e.rquestChange("stop"),e.currPressedKey="",e.currPressedKeyCode="")},doHideControlButton:function(){this.$store.commit(Rt+"/"+h["a"].CHANGE_CONTROL_BUTTON_STATUS,!1)},doControlPanelChange:function(t){var e=this,a=zt[t];void 0!==a&&(e.rquestChange(a),"Stop"!=t&&e.rquestChange("stop"))},getKeyCode:function(t){var e="";switch(t.key){case"1":e=5;break;case"2":e=1;break;case"ArrowDown":e=1;break;case"3":e=7;break;case"4":e=2;break;case"ArrowLeft":e=2;break;case"5":e=10;break;case"6":e=3;break;case"ArrowRight":e=3;break;case"7":e=4;break;case"8":e=0;break;case"ArrowUp":e=0;break;case"9":e=6;break;case"0":e=11;break;case"+":e=8;break;case"-":e=9;break}return e},rquestChange:function(t){var e=this,a=e.directionChangeReqList;if("stop"!=t)for(var i=0;i<a.length;)"stop"==a[i]?a.splice(i,1):i++;a.push(t),e.reqListProcessing||(e.reqListProcessing=!0,e.changeGunDirection())},changeGunDirection:function(){var t=this;if(t.directionChangeReqList.length){var e=t.directionChangeReqList.shift(),a=null,i=t.camera.camera_sno;a="stop"==e?t.$ajax({url:"/data/momitor/CameraStop?sno="+i,method:"post"}):t.$ajax({url:"/data/momitor/CameraRun?sno="+i+"&direction="+e,method:"post"}),a.then(function(e){t.changeGunDirection()})}else t.reqListProcessing=!1}},beforeDestroy:function(){var t=this;t.player&&t.player.dispose(),t.proxyPlayer&&t.proxyPlayer.dispose(),t.directionChangeReqList.length&&(t.directionChangeReqList=["stop"],t.changeGunDirection()),document.removeEventListener("keydown",t.doHandleKeyDown),document.removeEventListener("keyup",t.doHandleKeyUp)}},Yt=Wt,Kt=Object(C["a"])(Yt,At,Et,!1,null,null,null),qt=Kt.exports,Bt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Plane",{staticClass:"camera360 no-shadow",attrs:{full:t.camera360FullState}},[a("PlaneTitle",{on:{click:function(e){return t.doHideControlButton()}}},[t._v("视频监控"),a("span",{directives:[{name:"show",rawName:"v-show",value:t.video360Name,expression:"video360Name"}]},[t._v("（"+t._s(t.video360Name)+"）")])]),a("div",{staticClass:"plane-content"},[a("div",{ref:"container",staticClass:"video-container flv"},[a("video",{attrs:{id:"camera-360-flash",playsInline:"","webkit-playsinline":"",autoplay:""}})]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showLoading,expression:"showLoading"}],staticClass:"video-container loading"},[a("Loading")],1)]),a("PlaneTools",{attrs:{full:t.camera360FullState},on:{change:t.doFullStateChange}}),a("ControlPanel",{on:{change:t.doControlPanelChange}})],1)},Zt=[],Jt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},Qt=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ring-loading-wrap"},[a("div",{staticClass:"ring-loading"},[a("div",{staticClass:"ring-loading-light"}),a("div",{staticClass:"ring-loading-track"})])])}],Xt=(a("cb13"),{}),te=Object(C["a"])(Xt,Jt,Qt,!1,null,null,null),ee=te.exports,ae="camera360FullState",ie=p["a"].IOT,ne=Object(f["a"])(ie).mapState,oe="$store.state.".concat(ie),re=("".concat(oe,".videoUrl360"),"".concat(oe,".camera360FullState")),se="$store.state.windowResizeState",ce={ArrowUp:0,ArrowDown:1,ArrowLeft:2,ArrowRight:3,ZoomIn:8,ZoomOut:9,Stop:"stop"},le={name:"Iot360FlashVideo",components:{ControlPanel:$t,Loading:ee},computed:Object(m["a"])({},ne(["videoUrl360","video360Name","camera","camera360FullState"])),created:function(){var t=this;t.$store;document.addEventListener("keydown",t.doHandleKeyDown),document.addEventListener("keyup",t.doHandleKeyUp)},watch:(c={},Object(k["a"])(c,re,function(t){var e=this;if(t)e.init();else{e.player&&e.player.stop(),e.showLoading=!0,e.player=null;var a=e.$refs;a.container.innerHTML='<video id="camera-360-flash" controls playsInline webkit-playsinline autoplay></video>',setTimeout(function(){e.videoWrap=a.container.querySelector("video")},50),e.$store.commit(ie+"/"+h["a"].CHANGE_CONTROL_BUTTON_STATUS,!1)}}),Object(k["a"])(c,se,function(){var t=this,e=t.getSize(),a=e.w,i=e.h,n=a,o=i,r=t.videoWrap;t.player&&t.videoWrap&&(r.style.width=n+"px",r.style.height=o+"px")}),c),mounted:function(){var t=this;t.$nextTick(function(){var e=t.$refs;t.videoWrap=e.container.querySelector("video"),t.init()})},data:function(){return{videoWrap:null,player:null,currPressedKey:"",currPressedKeyCode:"",directionChangeReqList:[],reqListProcessing:!1,showLoading:!0}},methods:{init:function(){var t=this;t.$nextTick(function(){var e=t.getSize(),a=e.w,i=e.h;a>500&&t.initVideo(a,i)})},initVideo:function(t,e){var a=this,i=a.videoUrl360;if(i){var n=a.videoWrap,o=a.getVideoUrl(i);console.log("播放地址...",o);var r=t,s=e;n.style.width=r+"px",n.style.height=s+"px",n.innerHTML='<source src="'.concat(o,'" type="rtmp/flv" />');a.player;a.$nextTick(function(){a.player=new EZUIKit.EZUIPlayer({id:"camera-360-flash"}),setTimeout(function(){a.showLoading=!1},3500)})}},getSize:function(){var t=this,e=t.$refs.container.parentNode;if(e){var a=getComputedStyle(e,null),i=parseInt(a.width)||0,n=parseInt(a.height)||0;return{w:i,h:n}}return{w:0,h:0}},doFullStateChange:function(t){var e=this;e.$store.commit(ie+"/"+h["a"].IOT_CHANGE_FULL_STATE,{fullStateName:ae,state:t})},getVideoUrl:function(t){var e=t.lastIndexOf("/"),a=t.substr(e+1,32);E["d"].ios.test(navigator.userAgent);return"rtmp://rtmp01open.ys7.com/openlive/".concat(a).concat(window.hd?".hd":"")},doHandleKeyDown:function(t){var e=this,a=e.getKeyCode(t);"number"==typeof a&&e.camera360FullState&&(e.currPressedKey=t.key,e.currPressedKeyCode=a,e.rquestChange(a))},doHandleKeyUp:function(t){var e=this;t.key;"number"==typeof e.currPressedKeyCode&&e.camera360FullState&&(e.rquestChange("stop"),e.currPressedKey="",e.currPressedKeyCode="")},doHideControlButton:function(){this.$store.commit(ie+"/"+h["a"].CHANGE_CONTROL_BUTTON_STATUS,!1)},doControlPanelChange:function(t){var e=this,a=ce[t];void 0!==a&&(e.rquestChange(a),"Stop"!=t&&e.rquestChange("stop"))},getKeyCode:function(t){console.log("key...",t.key);var e="";switch(t.key){case"1":e=5;break;case"2":e=1;break;case"ArrowDown":e=1;break;case"3":e=7;break;case"4":e=2;break;case"ArrowLeft":e=2;break;case"5":e=10;break;case"6":e=3;break;case"ArrowRight":e=3;break;case"7":e=4;break;case"8":e=0;break;case"ArrowUp":e=0;break;case"9":e=6;break;case"0":e=11;break;case"+":e=8;break;case"-":e=9;break}return e},rquestChange:function(t){var e=this,a=e.directionChangeReqList;if("stop"!=t)for(var i=0;i<a.length;)"stop"==a[i]?a.splice(i,1):i++;a.push(t),e.reqListProcessing||(e.reqListProcessing=!0,e.changeGunDirection())},changeGunDirection:function(){var t=this;if(t.directionChangeReqList.length){var e=t.directionChangeReqList.shift(),a=null,i=t.camera.camera_sno;a="stop"==e?t.$ajax({url:"/data/momitor/CameraStop?sno="+i,method:"post"}):t.$ajax({url:"/data/momitor/CameraRun?sno="+i+"&direction="+e,method:"post"}),a.then(function(e){t.changeGunDirection()})}else t.reqListProcessing=!1}},beforeDestroy:function(){var t=this;t.player&&t.player.stop(),t.directionChangeReqList.length&&(t.directionChangeReqList=["stop"],t.changeGunDirection()),document.removeEventListener("keydown",t.doHandleKeyDown),document.removeEventListener("keyup",t.doHandleKeyUp)}},ue=le,de=Object(C["a"])(ue,Bt,Zt,!1,null,null,null),me=de.exports,he=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"map-container",attrs:{id:"map-container"}},[a("div",{ref:"wrap",staticClass:"map-wrap"}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showResetBtn,expression:"showResetBtn"}],staticClass:"iconfont map-reset-btn",attrs:{title:"复位"},on:{click:function(e){return t.doResetMap()}}},[t._v("")])])},fe=[],pe=(a("7bc1"),a("4964")),ve=(a("1294"),a("1a1e")),ye=p["a"].IOT,ge=Object(f["a"])(ye).mapState,we="$store.state.".concat(ye),_e="".concat(we,".iotDatas"),Te={lng:0,lat:0},Ce=(l={},Object(k["a"])(l,h["a"].IOT_TYPE_SPHERE,"全景摄像头"),Object(k["a"])(l,h["a"].IOT_TYPE_FM1,"FM1监控设备"),Object(k["a"])(l,h["a"].IOT_TYPE_FM2,"FM2监控设备"),Object(k["a"])(l,h["a"].IOT_TYPE_GUN,"普通摄像头"),Object(k["a"])(l,h["a"].IOT_TYPE_360,"云台摄像头"),l),be={name:"GMap",data:function(){return{map:null,markers:[],markerCluster:null,showResetBtn:!1,centerPosition:[0,0]}},computed:Object(m["a"])({},ge(["currVisibleIotType","currActive"]),Object(f["c"])(["userRole"]),{iotDatas:function(){var t=this;return t.$store.state[ye].iotDatas.filter(function(t){return t.show})}}),watch:Object(k["a"])({},_e,function(){this.addMarkers()}),mounted:function(){var t=this;t.$nextTick(function(){t.init()}),document.body.addEventListener("click",t.handlePageClick)},methods:{init:function(){var t=this,e=new google.maps.LatLng(ve["a"].iotMonitorMap.center[1],ve["a"].iotMonitorMap.center[0]);t.map=new google.maps.Map(t.$refs.wrap,{center:e,zoom:ve["a"].iotMonitorMap.zoom,maxZoom:20,mapTypeId:"hybrid",gestureHandling:"greedy",keyboardShortcuts:!1,styles:[{elementType:"labels.icon",stylers:[{visibility:"off"}]}]}),t.map.addListener("zoom_changed",function(){t.doRefreshTips()}),t.map.addListener("center_changed",function(){t.doRefreshTips()}),t.iotDatas.length&&t.addMarkers()},doRefreshTips:function(){var t=this;t.showResetBtn=!0,setTimeout(function(){t.refreshMarkerTips()},1e3),setTimeout(function(){t.refreshMarkerTips()},3e3)},addMarkers:function(){var t=this;t.markerCluster&&t.markerCluster.clearMarkers(),t.deleteAllMarkers();var e=0,a=0,i=0;t.iotDatas.forEach(function(n){n.address_gislong<n.address_gislatd&&(i=n.address_gislatd,n.address_gislatd=n.address_gislong,n.address_gislong=i),e+=n.address_gislong,a+=n.address_gislatd,t.markers.push(t.createMarker(n))}),0==t.centerPosition[0]&&(t.centerPosition[0]=e/t.iotDatas.length,t.centerPosition[1]=a/t.iotDatas.length,t.doResetMap());var n=t.map;t.markerCluster=new MarkerClusterer(n,t.markers,{gridSize:30,maxZoom:16}),n.addListener("clusterclick",function(){setTimeout(function(){n.getZoom()<20&&n.setZoom(20),Te.lng&&Te.lat&&(n.setCenter(Te),Te.lng=0,Te.lat=0)},500)}),setTimeout(function(){t.refreshMarkerTips()},3e3)},createMarker:function(t){var e=this,a=t.type,i=t.address_gislatd,n=t.address_gislong,o=t.isActive,r=e.getMarkerIcon(a,o),s=t.camera_name||t.name||t.em_name||"",c=new google.maps.Marker({position:{lat:i,lng:n},draggable:"2"==e.userRole,map:t.show?e.map:null,icon:r,title:a+(s?" ".concat(s):"")});return c.iot_index=t.index,c.addListener("click",function(){t.isActive||e.doHandlerClickMarker(t)}),"2"==e.userRole&&c.addListener("dragend",function(a){var i=t.sno||t.camera_sno||t.em_devid,n="";t.type==h["a"].IOT_TYPE_GUN||t.type==h["a"].IOT_TYPE_360?n="camera":t.type==h["a"].IOT_TYPE_SPHERE?n="em":t.type==h["a"].IOT_TYPE_FM1?n="fm1":t.type==h["a"].IOT_TYPE_FM2&&(n="fm2"),i&&n&&e.$ajax({url:"/data/momitor/updateLocation",method:"post",data:{sno:i,type:n,address_gislong:a.latLng.lng(),address_gislatd:a.latLng.lat()}}).then(function(t){200==t.code&&e.$store.commit(h["a"].SWITCH_MESSAGE_TIP,{tip:"设备位置修改成功！",show:!0})})}),c},doHandlerClickMarker:function(t){var e=this,a=e.$store;if(!t.isActive){if("B"==t.online)return a.commit(h["a"].SWITCH_MESSAGE_TIP,{tip:"设备不在线！",show:!0});var i=t.type;if(i==h["a"].IOT_TYPE_SPHERE)/yfkjtea/i.test(navigator.userAgent)?a.dispatch(ye+"/"+h["a"].CHANGE_PHOTO_VIEW_URL,{id:t.em_devid,name:t.em_name}).then(function(t){var e=[{key:"openAppPhotoViewer",value:"1"},{key:"url",value:t.url},{key:"title",value:t.title},{key:"time",value:t.time}],a=e.map(function(t){return t.key+"="+encodeURIComponent(t.value)}).join("&");location.href="openAppPhotoWindow?"+a}):(a.commit("".concat(ye,"/").concat(h["a"].IOT_CHANGE_FULL_STATE),{fullStateName:"photoViewerFullState",state:!0}),a.dispatch(ye+"/"+h["a"].CHANGE_PHOTO_VIEW_URL,{id:t.em_devid,name:t.em_name}));else if(i==h["a"].IOT_TYPE_360)if(/yfkjtea/i.test(navigator.userAgent)){var n=[{key:"openAppVideo",value:"1"},{key:"videoUrl",value:"ezopen://open.ys7.com/".concat(t.camera_sno,"/1.hd.live")},{key:"name",value:t.camera_name},{key:"token",value:a.state.appVideoToken},{key:"sno",value:t.camera_sno},{key:"key",value:a.state.appVideoKey},{key:"userToken",value:a.state.userToken}],o=n.map(function(t){return t.key+"="+encodeURIComponent(t.value)}).join("&");location.href="openAppVideoWindow?"+o}else a.commit("".concat(ye,"/").concat(h["a"].IOT_CHANGE_FULL_STATE),{fullStateName:"camera360FullState",state:!0}),a.commit(ye+"/"+h["a"].GET_360_DATA,t);else{var r=e.currActive.index,s=e.markers[r],c=e.iotDatas[r];if(s){var l=e.getMarkerIcon(c.type,!1);s.setIcon(l)}var u=e.markers[t.index];if(u){var d=e.getMarkerIcon(t.type,!0);u.setIcon(d)}a.commit(ye+"/"+h["a"].CHANGE_ACTIVE_MARKER,{index:t.index,type:i}),i==h["a"].IOT_TYPE_FM1?a.dispatch(ye+"/"+h["a"].GET_FM1_DATA,t.sno):t.type==h["a"].IOT_TYPE_FM2?a.dispatch(ye+"/"+h["a"].GET_FM2_DATA,t.sno):t.type==h["a"].IOT_TYPE_GUN&&a.commit(ye+"/"+h["a"].GET_GUN_DATA,t)}e.doRefreshTips()}},getMarkerIcon:function(t,e){var a="";return t==h["a"].IOT_TYPE_SPHERE?a=ve["a"].sphereMarkerImgUrl[e?"active":"normal"]:t==h["a"].IOT_TYPE_FM1?a=ve["a"].fm1MarkerImgUrl[e?"active":"normal"]:t==h["a"].IOT_TYPE_GUN?a=ve["a"].gunMarkerImgUrl[e?"active":"normal"]:t==h["a"].IOT_TYPE_FM2?a=ve["a"].fm2MarkerImgUrl[e?"active":"normal"]:t==h["a"].IOT_TYPE_360&&(a=ve["a"].photoMarkerImgUrl[e?"active":"normal"]),a},deleteAllMarkers:function(){var t=this;t.markers.length&&(t.markers.forEach(function(t){return t.setMap(null)}),t.markers=[])},refreshMarkerTips:function(){var t=[].concat(Object(pe["a"])(document.querySelectorAll("div[data-title^=IOT]")),Object(pe["a"])(document.querySelectorAll("div[title^=IOT]"))),e="",a="";t.forEach(function(t){if(t.querySelector("div"))t.removeAttribute("title");else{a=t.getAttribute("title").split(" "),e=a[0],t.style.overflow="visible",t.setAttribute("data-title",e);var i=document.createElement("div");i.style.background="rgba(12, 24, 56, 0.9)",i.style.position="absolute",a.length>1?i.innerHTML=a[1]+"(".concat(Ce[e],")"):i.innerHTML="查看该"+Ce[e],t.appendChild(i),t.removeAttribute("title")}})},handlePageClick:function(t){var e=this,a=t.target;if(a&&a.classList.contains("google-cluster-tip")){var i=a.getAttribute("data-iot-index");if(void 0!=i&&null!=i){var n=e.iotDatas[i-0];Te.lat=n.address_gislatd,Te.lng=n.address_gislong,n&&e.doHandlerClickMarker(n)}}},doResetMap:function(){var t=this;if(t.map){var e=t.centerPosition[0]||ve["a"].iotMonitorMap.center[0],a=t.centerPosition[1]||ve["a"].iotMonitorMap.center[1],i=new google.maps.LatLng(a,e);t.map.setOptions({center:i,zoom:ve["a"].iotMonitorMap.zoom}),t.showResetBtn=!1}}},beforeDestroy:function(){var t=this;document.body.removeEventListener("click",t.handlePageClick)}},Se=be,xe=Object(C["a"])(Se,he,fe,!1,null,null,null),Oe=xe.exports,ke=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Plane",{staticClass:"photo-viewer no-shadow",attrs:{full:t.photoViewerFullState}},[a("PlaneTitle",{staticClass:"no-icon"},[t._v(t._s(t.photoViewName||"全景图")),a("span",{directives:[{name:"show",rawName:"v-show",value:t.photoViewTime,expression:"photoViewTime"}]},[t._v("拍摄时间："+t._s(t.photoViewTime))])]),a("div",{ref:"container",staticClass:"plane-content",attrs:{id:"container"}}),a("PlaneTools",{attrs:{full:t.photoViewerFullState},on:{change:t.doFullStateChange}})],1)},Ae=[],Ee=p["a"].IOT,Ie="photoViewerFullState",Pe=Object(f["a"])(Ee).mapState,Fe="$store.state.".concat(Ee,".photoViewUrl"),Le={name:"IotPhotoViewer",computed:Object(m["a"])({},Pe(["photoViewerFullState","photoViewUrl","currActive","photoViewName","photoViewTime"])),watch:Object(k["a"])({},Fe,function(t,e){clearTimeout(this.timer),this.init()}),data:function(){return{container:null,viewer:null,timer:null}},mounted:function(){var t=this;t.$nextTick(function(){t.container=t.$refs.container,t.init()})},methods:{init:function(){var t=this,e=getComputedStyle(t.container,null),a=parseInt(e.width),i=parseInt(e.height);isNaN(a)||isNaN(i)?t.timer=setTimeout(function(){t.init()},200):t.photoViewUrl&&(t.viewer&&removepano("krpano"),embedpano({xml:"./jslib/krpano.xml",target:"container",id:"krpano",initvars:{source:t.photoViewUrl},onready:function(e){t.viewer=e}}))},doRefresh:function(){var t=this;t.$store;t.viewer&&t.viewer.setPanorama(t.photoViewUrl)},doFullStateChange:function(t){var e=this;e.$store.commit(Ee+"/"+h["a"].IOT_CHANGE_FULL_STATE,{fullStateName:Ie,state:t})}},beforeDestroy:function(){this.viewer&&removepano("krpano")}},Me=Le,Ne=Object(C["a"])(Me,ke,Ae,!1,null,null,null),De=Ne.exports,$e=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"message-tip"},[t._v(t._s(t.tip))])},je=[],Re="$store.state.showMessageTip",He={name:"NoResult",computed:{tip:function(){return this.$store.state.tip}},watch:Object(k["a"])({},Re,function(t){var e=this,a=this.$el;t&&(a.classList.add("show"),setTimeout(function(){a.classList.add("active")},100),setTimeout(function(){a&&a.classList.remove("active"),setTimeout(function(){a&&a.classList.remove("show")},100),e.$store.commit(h["a"].SWITCH_MESSAGE_TIP,{show:!1})},3e3))})},Ue=He,Ge=Object(C["a"])(Ue,$e,je,!1,null,null,null),Ve=Ge.exports,ze=p["a"].IOT,We=Object(f["a"])(ze).mapState,Ye={name:"IotIndex",computed:Object(m["a"])({},We(["currActive","photoViewerFullState","camera360FullState","fm1","fm2"])),components:{FM1Charts:G,FM2Charts:et,WFCharts:ft,GMap:Oe,CameraVideo:kt,Amount:S,PhotoViewer:De,Camera360:qt,Message:Ve,Camera360Flash:me},data:function(){return{types:h["a"],timer:null,useFlash:!!window.useFlash}},created:function(){var t=this,e=t.$store;e.commit(h["a"].SWITCH_LOADING,!1),e.dispatch(ze+"/"+h["a"].GET_IOT_DATA),t.timer=setInterval(function(){var a="IOT_TYPE_FM1"==t.currActive.type&&"HOUR"==t.fm1.time||"IOT_TYPE_FM2"==t.currActive.type&&"HOUR"==t.fm2.time,i=(new Date).getMinutes();a&&(e.dispatch(ze+"/"+("IOT_TYPE_FM1"==t.currActive.type?h["a"].GET_FM1_DATA:h["a"].GET_FM2_DATA)),31!=i&&1!=i||e.dispatch(ze+"/"+("IOT_TYPE_FM1"==t.currActive.type?h["a"].GET_FM1_DATA:h["a"].GET_FM2_DATA)))},6e4)},beforeDestroy:function(){var t=this,e=t.$store,a=[{state:"photoViewerFullState"},{state:"camera360FullState"},{state:"curveChartFullState",subModuleName:"fm1"},{state:"curveChartFullState",subModuleName:"fm2"},{state:"curveChartFullState",subModuleName:"wf"}];a.forEach(function(t){e.commit("".concat(ze,"/").concat(h["a"].IOT_CHANGE_FULL_STATE),{fullStateName:t.state,state:!1,subModuleName:t.subModuleName})}),e.commit(ze+"/"+h["a"].CHANGE_CONTROL_BUTTON_STATUS,!1),e.commit(ze+"/"+h["a"].CHANGE_VISIBLE_IOT_TYPE,""),e.commit(ze+"/"+h["a"].CHANGE_ACTIVE_MARKER,{index:0,type:h["a"].IOT_TYPE_FM1}),t.timer&&clearInterval(t.timer)}},Ke=Ye,qe=(a("65dd"),Object(C["a"])(Ke,u,d,!1,null,null,null));e["default"]=qe.exports}}]);